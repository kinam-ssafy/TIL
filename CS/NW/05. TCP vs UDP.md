# TCP vs UDP

## 전송 계층 (Transport Layer) 개념

**전송 계층의 역할**
- **종단 간(End-to-End) 통신** 제공
- 프로세스 간 데이터 전달
- 포트 번호로 애플리케이션 구분
- 오류 제어, 흐름 제어, 혼잡 제어

**vs. 네트워크 계층**
- 네트워크 계층: 호스트 간(Host-to-Host) 경로 결정
- 전송 계층: 프로세스 간(Process-to-Process) 데이터 전달

<br>

---

## 포트 번호 (Port Number)

**개념**
- 하나의 호스트에서 **여러 애플리케이션을 구분**하는 번호
- 16비트 (0 ~ 65535)

**구분**
| 범위 | 종류 | 설명 |
| --- | --- | --- |
| 0 ~ 1023 | Well-Known Port | 잘 알려진 서비스 (HTTP: 80, HTTPS: 443) |
| 1024 ~ 49151 | Registered Port | 등록된 애플리케이션 |
| 49152 ~ 65535 | Dynamic Port | 임시 포트 (클라이언트가 사용) |

**주요 포트 번호**
| 서비스 | 프로토콜 | 포트 |
| --- | --- | --- |
| HTTP | TCP | 80 |
| HTTPS | TCP | 443 |
| FTP | TCP | 20, 21 |
| SSH | TCP | 22 |
| DNS | UDP | 53 |
| DHCP | UDP | 67, 68 |
| SMTP | TCP | 25 |

<br>

---

## TCP (Transmission Control Protocol)

### 특징

**연결 지향 (Connection-Oriented)**
- 데이터 전송 전 연결 수립 필요
- 3-Way Handshake로 연결
- 4-Way Handshake로 종료

**신뢰성 보장 (Reliable)**
- 데이터 순서 보장
- 오류 검출 및 재전송
- 손실된 패킷 복구

**흐름 제어 (Flow Control)**
- 송신자와 수신자의 속도 조절
- 수신 버퍼 오버플로우 방지

**혼잡 제어 (Congestion Control)**
- 네트워크 혼잡도에 따라 전송 속도 조절

<br>

### TCP 헤더 구조

```
0                   15 16                  31
┌──────────────────────┬──────────────────────┐
│    Source Port       │  Destination Port    │ 
├──────────────────────┴──────────────────────┤
│           Sequence Number                   │
├─────────────────────────────────────────────┤
│        Acknowledgment Number                │
├──────┬─────┬────────┬────────────────────────┤
│Offset│Rsv  │ Flags  │    Window Size        │
├──────┴─────┴────────┼───────────────────────┤
│    Checksum         │   Urgent Pointer      │
├─────────────────────┴───────────────────────┤
│              Options (선택)                  │
└─────────────────────────────────────────────┘
```

**주요 필드**
| 필드 | 크기 | 설명 |
| --- | --- | --- |
| Source/Dest Port | 16bit | 출발지/목적지 포트 |
| Sequence Number | 32bit | 순서 번호 (바이트 단위) |
| Acknowledgment Number | 32bit | 확인 응답 번호 |
| Flags | 6bit | SYN, ACK, FIN, RST 등 |
| Window Size | 16bit | 수신 윈도우 크기 |
| Checksum | 16bit | 오류 검출 |

<br>

### TCP 연결 과정

**3-Way Handshake (연결 수립)**
```
Client                          Server
   │                               │
   │───────SYN (seq=100)──────────>│ 1. 연결 요청
   │                               │
   │<──SYN+ACK (seq=300,ack=101)───│ 2. 연결 수락 + 응답
   │                               │
   │────ACK (seq=101,ack=301)─────>│ 3. 최종 확인
   │                               │
   │ [연결 수립 완료 - ESTABLISHED] │
```

**4-Way Handshake (연결 종료)**
```
Client                          Server
   │                               │
   │────────FIN (seq=200)─────────>│ 1. 종료 요청
   │                               │
   │<───────ACK (ack=201)──────────│ 2. 종료 요청 확인
   │                               │
   │<───────FIN (seq=400)──────────│ 3. 서버도 종료 요청
   │                               │
   │────────ACK (ack=401)─────────>│ 4. 최종 확인
   │                               │
   │      [연결 종료 완료]           │
```

<br>

### 데이터 전송 과정

**순서 번호와 확인 응답**
```
Client                          Server
   │                               │
   │────Data (seq=100, len=100)───>│
   │                               │
   │<──────ACK (ack=200)───────────│ 다음 받을 번호
   │                               │
   │────Data (seq=200, len=150)───>│
   │                               │
   │<──────ACK (ack=350)───────────│
```

**재전송 메커니즘**
```
Client                          Server
   │                               │
   │────Data (seq=100, len=100)───>│
   │                               │
   │────Data (seq=200, len=100)──X │ 손실!
   │                               │
   │────Data (seq=300, len=100)───>│
   │                               │
   │<──────ACK (ack=200)───────────│ 중복 ACK
   │<──────ACK (ack=200)───────────│ 중복 ACK
   │                               │
   │────Data (seq=200, len=100)───>│ 재전송
   │                               │
   │<──────ACK (ack=400)───────────│
```

<br>

---

## UDP (User Datagram Protocol)

### 특징

**비연결성 (Connectionless)**
- 연결 수립 과정 없음
- 독립적인 데이터그램 전송

**비신뢰성 (Unreliable)**
- 순서 보장 안 함
- 오류 검출만 가능 (재전송 안 함)
- 손실 가능성 있음

**빠른 전송**
- 오버헤드 적음
- 실시간 전송에 유리

<br>

### UDP 헤더 구조

```
0                   15 16                  31
┌──────────────────────┬──────────────────────┐
│    Source Port       │  Destination Port    │ 
├──────────────────────┼──────────────────────┤
│       Length         │      Checksum        │
└──────────────────────┴──────────────────────┘
│              Data (데이터)                   │
```

**매우 단순함 (8바이트)**
| 필드 | 크기 | 설명 |
| --- | --- | --- |
| Source Port | 16bit | 출발지 포트 |
| Destination Port | 16bit | 목적지 포트 |
| Length | 16bit | 전체 길이 |
| Checksum | 16bit | 오류 검출 (선택) |

<br>

### UDP 전송 과정

```
Client                          Server
   │                               │
   │────Datagram 1────────────────>│
   │                               │
   │────Datagram 2────────────────>│
   │                               │
   │────Datagram 3───────────────X │ 손실 (재전송 안 함)
   │                               │
   │────Datagram 4────────────────>│
   │                               │

특징:
- 연결 수립 없음
- ACK 없음
- 재전송 없음
- 순서 보장 안 함
```

<br>

---

## TCP vs UDP 비교

| 구분 | TCP | UDP |
| --- | --- | --- |
| **연결 방식** | 연결 지향 (3-Way Handshake) | 비연결성 |
| **신뢰성** | 보장 (재전송, 순서 보장) | 보장 안 함 |
| **순서 보장** | 보장 | 보장 안 함 |
| **속도** | 느림 (오버헤드 큼) | 빠름 (오버헤드 작음) |
| **헤더 크기** | 20~60 바이트 | 8 바이트 |
| **혼잡 제어** | 있음 | 없음 |
| **흐름 제어** | 있음 | 없음 |
| **브로드캐스트** | 불가 | 가능 |
| **사용 예** | 파일 전송, 이메일, 웹 | 스트리밍, DNS, 게임 |

<br>

---

## 사용 시나리오

### TCP를 사용하는 경우

**신뢰성이 중요한 서비스**
```
웹 브라우징 (HTTP/HTTPS):
- 완전한 웹 페이지 전송 필요
- 순서 보장 중요

파일 전송 (FTP):
- 데이터 손실 불가
- 완전성 보장

이메일 (SMTP, POP3, IMAP):
- 메일 내용 정확히 전달
- 첨부파일 무결성

원격 접속 (SSH, Telnet):
- 명령어 정확한 전달
```

<br>

### UDP를 사용하는 경우

**속도가 중요한 서비스**
```
실시간 스트리밍:
- 동영상/음성 스트리밍
- 약간의 손실 허용
- 실시간성 중요

온라인 게임:
- 빠른 반응 필요
- 최신 상태만 중요
- 이전 패킷 손실 무관

DNS 조회:
- 간단한 요청/응답
- 빠른 처리 필요
- 실패 시 재요청

DHCP:
- IP 주소 할당
- 브로드캐스트 필요

IoT 센서 데이터:
- 주기적 전송
- 최신 데이터만 의미 있음
```

<br>

---

## 신뢰성 vs 성능 트레이드오프

```
TCP (신뢰성 우선):
┌─────────────────────────────┐
│ 연결 수립 → 데이터 전송 →   │
│ ACK 대기 → 재전송 확인 →    │
│ 순서 정렬 → 연결 종료       │
└─────────────────────────────┘
시간: ━━━━━━━━━━━━━━━━━━━━━━
     느리지만 확실함


UDP (성능 우선):
┌─────────────────────────────┐
│ 데이터 전송 → 완료           │
└─────────────────────────────┘
시간: ━━━━━
     빠르지만 불확실함
```

<br>

---

## 실제 응용 프로그램 예시

### HTTP/3 (QUIC)
```
특징:
- UDP 기반
- TCP의 신뢰성을 애플리케이션 계층에서 구현
- TCP의 3-Way Handshake 불필요
- 더 빠른 연결 수립

장점:
- TCP + TLS보다 빠름
- 모바일 환경에 유리
```

<br>

### 게임에서의 혼합 사용
```
TCP 사용:
- 채팅 메시지
- 게임 설정 동기화
- 아이템 거래

UDP 사용:
- 플레이어 위치 정보
- 총알 발사 이벤트
- 실시간 음성 채팅
```

<br>

---

## 핵심 정리

### 프로토콜 선택 기준

```
신뢰성 > 속도: TCP
- 데이터 정확성 필수
- 순서 중요
- 완전한 데이터 전달

속도 > 신뢰성: UDP
- 실시간 전송
- 약간의 손실 허용
- 최신 데이터만 의미
```

### 주요 차이점 요약

```
TCP:
- 연결형, 신뢰성, 순서 보장
- 느림, 무겁지만 안전
- HTTP, FTP, 이메일

UDP:
- 비연결형, 비신뢰성
- 빠름, 가볍지만 불확실
- 스트리밍, DNS, 게임
```

### 헤더 크기 비교
```
TCP: 20~60 바이트 (복잡)
UDP: 8 바이트 (단순)
```

### 특수 사례
```
DNS: UDP 기본, 큰 응답은 TCP
HTTP/3: UDP 기반이지만 신뢰성 구현
VoIP: UDP 기반이지만 지터 버퍼링
```