# 라우팅 (Routing)

## 라우팅 개념

**라우팅(Routing)**
- 출발지에서 목적지까지 데이터를 전달하기 위한 **최적 경로를 결정**하는 과정
- 네트워크 계층(Layer 3)의 핵심 기능

**라우터(Router)**
- 라우팅을 수행하는 네트워크 장비
- IP 주소를 기반으로 패킷을 다음 경로로 전달

<br>

---

## 라우팅 vs 포워딩

| 구분 | 라우팅 (Routing) | 포워딩 (Forwarding) |
| --- | --- | --- |
| 의미 | 경로 결정 (Path selection) | 패킷 전달 (Packet delivery) |
| 범위 | 전체 경로 계획 | 다음 홉으로 전송 |
| 시간 | 비교적 느림 (주기적 업데이트) | 매우 빠름 (실시간) |
| 주체 | 라우팅 알고리즘 | 라우팅 테이블 참조 |
| 예시 | 서울 → 부산 가는 최적 경로 결정 | 현재 교차로에서 다음 방향 선택 |

<br>

---

## 라우팅 테이블 (Routing Table)

**개념**
- 라우터가 패킷을 어디로 보낼지 기록한 표

**구성 요소**
```
목적지 네트워크 | 서브넷 마스크 | 다음 홉(게이트웨이) | 인터페이스 | 메트릭
```

**예시**
| 목적지 | 넷마스크 | 게이트웨이 | 인터페이스 | 메트릭 |
| --- | --- | --- | --- | --- |
| 192.168.1.0 | /24 | 직접연결 | eth0 | 0 |
| 10.0.0.0 | /8 | 192.168.1.1 | eth0 | 1 |
| 0.0.0.0 | /0 | 192.168.1.254 | eth0 | 10 |

**특수 항목**
- `0.0.0.0/0`: 기본 게이트웨이 (모든 목적지의 기본 경로)
- 직접연결: 라우터에 직접 연결된 네트워크

<br>

---

## 라우팅 방식

### 정적 라우팅 (Static Routing)

**개념**
- 관리자가 수동으로 경로 설정

**특징**
```
장점:
- 네트워크 부하 없음
- 예측 가능
- 보안성 높음
- 설정 단순

단점:
- 확장성 낮음
- 네트워크 변화에 대응 불가
- 관리 부담 큼
```

**사용 환경**
- 소규모 네트워크
- 네트워크 토폴로지 고정
- 보안이 중요한 경우

<br>

### 동적 라우팅 (Dynamic Routing)

**개념**
- 라우팅 프로토콜을 통해 자동으로 경로 결정 및 업데이트

**특징**
```
장점:
- 자동 경로 갱신
- 장애 대응 자동화
- 확장성 좋음
- 최적 경로 자동 선택

단점:
- 네트워크 오버헤드 발생
- 설정 복잡
- CPU/메모리 사용량 증가
```

**사용 환경**
- 대규모 네트워크
- 네트워크 토폴로지 동적 변화
- 인터넷 백본

<br>

---

## 라우팅 알고리즘

### 분류

| 분류 기준 | 종류 |
| --- | --- |
| 정보 관리 | 집중형 / 분산형 |
| 경로 결정 | 정적 / 동적 |
| 경로 계산 방식 | Distance Vector / Link State |

<br>

### Distance Vector (거리 벡터)

**개념**
- 인접 라우터와 정보 교환
- 목적지까지의 **거리(홉 수 또는 비용)**와 **방향(다음 라우터)**만 알면 됨

**동작 원리**
```
1. 각 라우터가 인접 라우터에게 자신의 라우팅 테이블 전송
2. 받은 정보로 자신의 테이블 업데이트
3. 변경사항 발생 시 인접 라우터에게 전파
4. 주기적으로 반복
```

**특징**
| 장점 | 단점 |
| --- | --- |
| 구현 단순 | 느린 수렴 속도 |
| 메모리 적게 사용 | 라우팅 루프 발생 가능 |
| 작은 네트워크에 적합 | Count to Infinity 문제 |

**대표 프로토콜**
- RIP (Routing Information Protocol)

<br>

### Link State (링크 상태)

**개념**
- 네트워크 전체의 **토폴로지 맵**을 각 라우터가 보유
- 모든 라우터가 전체 네트워크 구조를 알고 있음

**동작 원리**
```
1. 각 라우터가 인접 링크 정보 수집
2. 링크 상태 정보를 네트워크 전체에 플러딩(Flooding)
3. 모든 라우터가 동일한 토폴로지 맵 구축
4. Dijkstra 알고리즘으로 최단 경로 계산
```

**특징**
| 장점 | 단점 |
| --- | --- |
| 빠른 수렴 속도 | 구현 복잡 |
| 루프 방지 | 메모리 많이 사용 |
| 확장성 좋음 | CPU 부담 큼 |
| 정확한 경로 계산 | 초기 플러딩 부하 |

**대표 프로토콜**
- OSPF (Open Shortest Path First)

<br>

### Distance Vector vs Link State 비교

| 구분 | Distance Vector | Link State |
| --- | --- | --- |
| 경로 정보 | 방향과 거리만 | 전체 토폴로지 |
| 업데이트 대상 | 인접 라우터만 | 모든 라우터 |
| 업데이트 내용 | 전체 라우팅 테이블 | 링크 상태 변화만 |
| 수렴 속도 | 느림 | 빠름 |
| 메모리 사용 | 적음 | 많음 |
| CPU 사용 | 적음 | 많음 |
| 확장성 | 낮음 | 높음 |

<br>

---

## 주요 라우팅 프로토콜

### 분류

**IGP (Interior Gateway Protocol) - AS 내부**
- 동일한 관리 도메인(AS) 내부에서 사용
- RIP, OSPF, EIGRP

**EGP (Exterior Gateway Protocol) - AS 간**
- 서로 다른 AS 간 라우팅
- BGP

<br>

### RIP (Routing Information Protocol)

| 특징 | 내용 |
| --- | --- |
| 알고리즘 | Distance Vector |
| 메트릭 | 홉 카운트 (최대 15홉) |
| 업데이트 주기 | 30초마다 전체 테이블 전송 |
| 수렴 속도 | 느림 |
| 용도 | 소규모 네트워크 |

**장단점**
```
장점:
- 설정 매우 간단
- 소규모에 적합

단점:
- 최대 15홉 제한
- 느린 수렴
- 대역폭 낭비
```

<br>

### OSPF (Open Shortest Path First)

| 특징 | 내용 |
| --- | --- |
| 알고리즘 | Link State |
| 메트릭 | 대역폭 기반 비용 |
| 업데이트 | 변경 시에만 LSA 전송 |
| 수렴 속도 | 빠름 |
| 용도 | 중대규모 네트워크, 기업망 |

**장단점**
```
장점:
- 빠른 수렴
- 무한 루프 방지
- 계층적 구조 (Area 개념)
- 대역폭 효율적

단점:
- 설정 복잡
- 메모리/CPU 사용량 높음
```

<br>

### BGP (Border Gateway Protocol)

| 특징 | 내용 |
| --- | --- |
| 알고리즘 | Path Vector |
| 메트릭 | AS 경로, 정책 기반 |
| 용도 | 인터넷 백본, ISP 간 |
| 스케일 | 전체 인터넷 |

**특징**
```
- AS(Autonomous System) 간 라우팅
- 정책 기반 라우팅 가능
- 인터넷의 핵심 프로토콜
- 안정성과 확장성 우선
```

<br>

---

## 메트릭 (Metric)

**개념**
- 경로의 우선순위를 결정하는 **비용 값**

**종류**

| 메트릭 | 의미 | 사용 프로토콜 |
| --- | --- | --- |
| 홉 카운트 | 거쳐가는 라우터 수 | RIP |
| 대역폭 | 링크 속도 | OSPF, EIGRP |
| 지연(Delay) | 전송 지연 시간 | EIGRP |
| 신뢰성 | 에러율 | EIGRP |
| 부하 | 트래픽 양 | EIGRP |
| MTU | 최대 전송 단위 | 일부 프로토콜 |

**경로 선택**
```
메트릭 값이 낮을수록 우선순위 높음

예시:
경로 A: 메트릭 10
경로 B: 메트릭 20
→ 경로 A 선택
```

<br>

---

## 라우팅 문제 및 해결

### Count to Infinity

**문제**
```
Distance Vector에서 링크 장애 시 
무한히 업데이트가 순환하는 문제

A ↔ B ↔ C
B-C 링크 다운 시:
B → A: C까지 2홉
A → B: C까지 3홉
B → A: C까지 4홉
...무한 반복
```

**해결책**
- **Split Horizon**: 정보를 받은 방향으로 다시 보내지 않음
- **Poison Reverse**: 도달 불가 경로를 무한대(16)로 표시
- **Maximum Hop Count**: 최대 홉 수 제한 (RIP는 15)

<br>

### 라우팅 루프

**문제**
- 패킷이 여러 라우터 사이를 계속 순환

**해결책**
- **TTL (Time To Live)**: 홉 수 제한, 0이 되면 폐기
- Link State 알고리즘 사용

<br>

---

## 핵심 정리

### 라우팅의 목적
```
출발지 → 목적지까지 최적 경로 결정
```

### 라우팅 방식 선택
```
소규모 고정 네트워크: 정적 라우팅
대규모 동적 네트워크: 동적 라우팅
```

### 알고리즘 비교
```
Distance Vector:
- 간단, 소규모
- RIP

Link State:
- 복잡, 대규모, 빠른 수렴
- OSPF
```

### 프로토콜 선택
```
AS 내부:
- 소규모: RIP
- 중대규모: OSPF

AS 간:
- BGP (인터넷 백본)
```

### 최적 경로 기준
```
메트릭 기반:
- 홉 수 (RIP)
- 대역폭 (OSPF)
- 정책 (BGP)
```